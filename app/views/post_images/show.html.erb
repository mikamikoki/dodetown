<% if flash[:notice] %>
  <p id="notice">
    <%= flash[:notice] %>
  </p>
<% end %>

<div>
  <%= attachment_image_tag @post_image, :image %>
  <p>店名：<%= @post_image.shop_name %></p>
  <p>住所</p>
  <p><%= @post_image.address %></p>
<!--  <div id="map"></div>-->
<!--   <style>-->
<!--  #map{-->
<!--  height: 150px;-->
<!--  width:270px;-->
<!--  }-->
<!--  </style>-->

<!--  <script type="text/javascript">-->
<!--    function initMap() {-->

<!--        var test ={lat: <#%= @post_image.latitube %>, lng: <#%= @post_image.longitude %>};-->
<!--        var map = new google.maps.Map(document.getElementById('map'), {-->
<!--            zoom: 15,-->
<!--            center: test-->
<!--        });-->
<!--        var transitLayer = new google.maps.TransitLayer();-->
<!--        transitLayer.setMap(map);-->
<!--        var contentString = '住所：<#%= @post_image.address %>';-->
<!--        var infowindow = new google.maps.InfoWindow({-->
<!--            content: contentString-->
<!--        });-->

<!--        var marker = new google.maps.Marker({-->
<!--            position:test,-->
<!--            map: map,-->
<!--            title: contentString-->
<!--        });-->

<!--        marker.addListener('click', function() {-->
<!--            infowindow.open(map, marker);-->
<!--        });-->
<!--    }-->
<!--</script>-->

<!--<script async defer-->
<!--        src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=<#%= ENV['GOOGLE_MAP_API_KEY'] %>&callback=initMap">-->
<!--</script>-->


<!-- 地名入力用のinputを追加 -->
<input id="address" type="textbox" value="Sydney, NSW">

<!-- buttonをクリックしたらcodeAddressを実行　-->
<input type="button" value="Encode" onclick="codeAddress()">
<div id='map'>
</div>
<style>
#map{
  height: 400px;
}
</style>

<script>
mapを関数の外で定義(codeAddressでも使うため)
geocoderを用意
*/

let map
let geocoder

function initMap(){
  // geocoderを初期化
  geocoder = new google.maps.Geocoder()

  map = new google.maps.Map(document.getElementById('map'), {
  center: {lat: -34.397, lng: 150.644},
  zoom: 8
  });
}

function codeAddress(){
  // 入力を取得
  let inputAddress = document.getElementById('address').value;

  // geocodingしたあとmapを移動
  geocoder.geocode( { 'address': inputAddress}, function(results, status) {
    if (status == 'OK') {
　　　　　　　　　　　　// map.setCenterで地図が移動
      map.setCenter(results[0].geometry.location);

　　　　　　　　　　　　// google.maps.MarkerでGoogleMap上の指定位置にマーカが立つ
      var marker = new google.maps.Marker({
          map: map,
          position: results[0].geometry.location
      });
    } else {
      alert('Geocode was not successful for the following reason: ' + status);
    }
  });
}
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAP_API_KEY'] %>&callback=initMap" async defer></script>
  <p>説明：<%= @post_image.caption %></p>
  <p>ユーザーネーム：<%= @post_image.user.name %></p>
  <p>投稿日時：<%= @post_image.created_at.strftime('%Y/%m/%d') %></p>
  <div id="favorite_buttons_<%= @post_image.id %>">
  <%= render "favorites/favorite", post_image: @post_image %>
  </div>
  <td>コメント数：<%= @post_image.post_comments.count %></td>
  <div id="comments_area">
   <%= render 'post_comments/post_comment', post_image: @post_image %>
  </div>
  <div class="new-comment">
   <%= render 'post_comments/form', post_image: @post_image, post_comment: @post_comment %>
  </div>
  <% if @post_image.user == current_user %>
    <%= link_to "削除", post_image_path(@post_image), method: :delete %>
    |
    <%= link_to "編集", edit_post_image_path(@post_image) %>
  <% end %>
</div>
